{% extends 'admin/layout.html' %}

{% block content %}

    <main role="main">
        <div class="notice">
            error
        </div>
        <div class="panel">
            <div class="new-post-prompt">
                create a new post:
                <input type="text" name="title" placeholder="title"/>
                <select name="category">
                    {% for cat in categories %}
                        <option value="{{ cat.slug }}">{{ cat.name }}</option>
                    {% endfor %}
                </select>
                <button class="js-new-post">create</button>
            </div>
        </div>

        {% for post in posts %}
            <div class="post">
                <h1><a href="{{ post.url }}">{{ post.title_html|safe }}</a></h1>
                <a href="/control/{{ post.category.slug }}/{{ post.slug }}">edit</a>
                <h6>Published on {{ post.published_at.strftime('%m.%d.%Y') }} in [<a href="{{ post.category.url }}">{{ post.category.name }}</a>]</h6>
                {{ post.html|safe }}
            </div>
        {% endfor %}
    </main>

{% endblock %}


{% block scripts %}
    <script>
        $(function() {
            $('.js-new-post').on('click', function() {
                var data = {
                    title: $('[name=title]').val()
                    category: $('[name=category]').val()
                }

                $.ajax({
                    url: '/control/{{ post.category.slug }}/{{ post.slug }}',
                    type: 'PUT',
                    data: JSON.stringify(data),
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    success: function(d) {
                        // go to edit post
                        document.location.href = '/control/' + d['category'] + '/' + d['slug']
                    },
                    error: function(jqxhr, textStatus, err) {
                        $('.notice').fadeIn();
                        console.log('error');
                    }
                });
            });
        });
    </script>
{% endblock %}
